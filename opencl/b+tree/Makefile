include ../../common/make.config
#C_C = gcc
#OCL_LIB = -lOpenCL

CFLAGS += $(KERNEL_DIM)
CXXFLAGS += $(KERNEL_DIM)

ifdef ALTERA
	ifdef HOST_ONLY
		AOT_PROGRAMS = 
	else
		AOT_PROGRAMS = AOCX
	endif
else
	AOT_PROGRAMS =
endif

# ====================================================================================================100
#	NVCC
# ====================================================================================================100

# CUD_C = nvcc
# OMP_FLAG = 	-Xcompiler paste_one_here

# ====================================================================================================100
#	PGCC
# ====================================================================================================100

# C_C = pgcc
# OMP_FLAG = -mp
# ACC_FLAG = 	-ta=nvidia \
			# -Minfo \
			# -Mbounds

# ====================================================================================================100
#	END
# ====================================================================================================100

# ======================================================================================================================================================150
#	END
# ======================================================================================================================================================150

# ========================================================================================================================================================================================================200
#	EXECUTABLES (LINK OBJECTS TOGETHER INTO BINARY)
# ========================================================================================================================================================================================================200

all: b+tree.out $(AOT_PROGRAMS)

b+tree.out:	./main.o \
		./kernel/kernel_gpu_opencl_wrapper.o \
		./kernel/kernel_gpu_opencl_wrapper_2.o \
		./util/timer/timer.o \
		./util/num/num.o \
		./util/opencl/opencl.o
	$(CC)	./main.o \
			./kernel/kernel_gpu_opencl_wrapper.o \
			./kernel/kernel_gpu_opencl_wrapper_2.o \
			./util/timer/timer.o \
			./util/num/num.o \
			./util/opencl/opencl.o \
			-lm \
			$(OPENCL_LIB) $(LDFLAGS) \
	                -o b+tree.out
# ========================================================================================================================================================================================================200
#	OBJECTS (COMPILE SOURCE FILES INTO OBJECTS)
# ========================================================================================================================================================================================================200

CFLAGS += -I.

# ======================================================================================================================================================150
#	MAIN FUNCTION
# ======================================================================================================================================================150

main.o:	./common.h \
		./main.h \
		./main.c
#	$(CC)	$(KERNEL_DIM) ./main.c \
#			-c \
#			-o ./main.o \
#			-O3
main.o: CFLAGS += $(OPENCL_INC) 
# ======================================================================================================================================================150
#	KERNELS
# ======================================================================================================================================================150

./kernel/kernel_gpu_opencl_wrapper.o:	./common.h \
										./kernel/kernel_gpu_opencl_wrapper.h \
										./kernel/kernel_gpu_opencl_wrapper.c
#	$(C_C)	$(KERNEL_DIM) ./kernel/kernel_gpu_opencl_wrapper.c \
#			-c \
#			-o ./kernel/kernel_gpu_opencl_wrapper.o \
#			-O3 \
#			-I$(OPENCL_INC)
./kernel/kernel_gpu_opencl_wrapper.o: CFLAGS += $(OPENCL_INC)

./kernel/kernel_gpu_opencl_wrapper_2.o:	./common.h \
										./kernel/kernel_gpu_opencl_wrapper_2.h \
										./kernel/kernel_gpu_opencl_wrapper_2.c
#	$(C_C)	$(KERNEL_DIM) ./kernel/kernel_gpu_opencl_wrapper_2.c \
#			-c \
#			-o ./kernel/kernel_gpu_opencl_wrapper_2.o \
#			-O3 \
#			-I$(OPENCL_INC)
./kernel/kernel_gpu_opencl_wrapper_2.o: CFLAGS += $(OPENCL_INC)
# ======================================================================================================================================================150
#	UTILITIES
# ======================================================================================================================================================150

./util/timer/timer.o:	./common.h \
						./util/timer/timer.h \
						./util/timer/timer.c
#	$(C_C)	./util/timer/timer.c \
#			-c \
#			-o ./util/timer/timer.o \
#			-O3

./util/num/num.o:	./common.h \
					./util/num/num.h \
					./util/num/num.c
#	$(C_C)	./util/num/num.c \
#			-c \
#			-o ./util/num/num.o \
#			-O3

./util/opencl/opencl.o:	./common.h \
						./util/opencl/opencl.h \
						./util/opencl/opencl.c
#	$(C_C)	./util/opencl/opencl.c \
#			-c \
#			-o ./util/opencl/opencl.o \
#			-O3 \
#			-I$(OPENCL_INC)
./util/opencl/opencl.o: CFLAGS += $(OPENCL_INC)
# ======================================================================================================================================================150
#	END
# ======================================================================================================================================================150

# ========================================================================================================================================================================================================200
#	DELETE
# ========================================================================================================================================================================================================200

clean:
	$(RM)	*.o *.out \
		./kernel/*.o \
		./util/timer/*.o \
		./util/num/*.o \
		./util/opencl/*.o \
                output.txt
	cd kernel; make clean
# ========================================================================================================================================================================================================200
#	END
# ========================================================================================================================================================================================================200

AOCX:
	cd kernel; make
